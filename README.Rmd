---
title: "README"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE}
library("data.table")

benchmarks <- readRDS("benchmarks.RDS")

averages <- as.data.table(benchmarks)[, 
                                      .(reading = mean(read_ratio),
                                        writing = mean(write_ratio)),
                                      by = .(threads)]
```

# Reading and writing benchmarks

Benchmarks of reading and writing csv files with `data.table::fread()` and `data.table::fwrite()` versus `readr::read_csv()` and `readr::write_csv()`. 

Related to https://github.com/tidyverse/readr/issues/931.

## Table of reading and writing benchmarks:

```{r, echo=FALSE}
benchmarks
```

In single thread mode, fread is an average `r round(averages[threads == 1, reading], 1)` times faster at reading and `r round(averages[threads == 1, writing], 1)` times faster at writing. In multithreaded mode — which is the default — fread is `r round(averages[threads == 4, reading], 1)` times faster at reading and `r round(averages[threads == 4, writing], 1)` times faster at writing.

## Graph of reading and writing benchmarks:

A visualization of the benchmarks in the table above.
```{r graph, echo=FALSE, dpi=300, fig.height=4}
library("ggplot2")

benchmarks_plot <- melt(benchmarks,  
                        id.vars = c("threads", "size_MB"),
                        measure.vars = c("fwrite", "fread", "write_csv", "read_csv"),
                        variable.name = "package",
                        value.name = "time")

benchmarks_plot[package == "write_csv", package := "readr writing"]
benchmarks_plot[package == "read_csv", package := "readr reading"]
benchmarks_plot[package == "fwrite", package := "data.table writing"]
benchmarks_plot[package == "fread", package := "data.table reading"]


benchmarks_plot[, threads := ifelse(threads == 1, paste0(threads, " thread"), "4 threads")]


ggplot(data = benchmarks_plot, 
       aes(x = size_MB, 
           y = time, 
           colour = package)) +
  facet_grid(. ~ threads) +
  geom_line() +
  scale_color_manual(values = c("readr reading" = "light blue",
                                "readr writing" = "dark blue",
                                "data.table reading" = "yellow",
                                "data.table writing" = "orange")) +
  labs(x = "Data size in MB",
       y = "Time in seconds") +
  theme(legend.position = "bottom")

```